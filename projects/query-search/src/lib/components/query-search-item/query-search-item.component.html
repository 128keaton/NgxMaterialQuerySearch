<mat-divider class="notate-group" [vertical]="true"></mat-divider>
<mat-divider class="notate-group-after"></mat-divider>

<button mat-mini-fab color="warn" class="delete-button" (click)="remove()" [disabled]="disableDelete">
  <mat-icon>delete</mat-icon>
</button>

<mat-divider class="separate-button"></mat-divider>

<mat-checkbox class="disable-checkbox" [(ngModel)]="item.active"></mat-checkbox>
<mat-divider class="separate-button" [class.pad-dividers]="padDividers"></mat-divider>

<mat-form-field [appearance]="formFieldAppearance" class="name-field">
  <mat-label>Field Name</mat-label>
  <mat-select [(ngModel)]="selectedField" (ngModelChange)="fieldSelected($event)">
    <mat-option *ngFor="let field of (fields|async)" [value]="field">
      <span class="field-value" *ngIf="field.tooltip" [matTooltip]="field.tooltip"
            matTooltipPosition="right">{{field.label || field.name}}</span>
      <span class="field-value" *ngIf="!field.tooltip">{{field.label || field.name}}</span>
    </mat-option>
  </mat-select>
</mat-form-field>
<ng-container *ngIf="showOperatorField">
  <mat-divider class="separate-fields" [class.pad-dividers]="padDividers"></mat-divider>
  <mat-form-field id="operatorField" [appearance]="formFieldAppearance" class="operator-field">
    <mat-label>Operator</mat-label>
    <mat-select [(ngModel)]="item.condition" (ngModelChange)="operatorSelected()">
      <mat-option *ngFor="let operator of operators" [value]="operator">
        {{operator|operatorName}} <span [style]="operatorStyle"
                                        *ngIf="(operator|operatorName: true)">{{operator|operatorName: true}}</span>
      </mat-option>
    </mat-select>
  </mat-form-field>
</ng-container>

<ng-container *ngIf="showValueField">
  <mat-divider class="separate-fields" [class.pad-dividers]="padDividers"></mat-divider>
  <ng-container *ngIf="!isDate; else dateField">
    <mat-form-field [appearance]="formFieldAppearance" *ngIf="!hasValues" class="value-field">
      <mat-label>Value</mat-label>
      <input autocomplete="off" *ngIf="!isNumber" matInput [(ngModel)]="item.value">
      <input autocomplete="off" *ngIf="isNumber" type="number" matInput [(ngModel)]="item.value">
    </mat-form-field>

    <mat-form-field [appearance]="formFieldAppearance" *ngIf="hasValues" class="value-field">
      <mat-label>Value</mat-label>
      <input matInput
             #valueInput
             [(ngModel)]="item.value"
             [matAutocomplete]="valueAutoComplete">
      <div class="input-spinner-wrapper">
        <mat-spinner *ngIf="isObservable && ($loading|async)" [diameter]="20" class="input-spinner"></mat-spinner>
      </div>
      <mat-autocomplete autoActiveFirstOption #valueAutoComplete="matAutocomplete">
        <mat-option>
          <div (click)="searchOptionClicked($event)" class="search-options-wrapper">
            <mat-icon>search</mat-icon>
            <input class="search-options" #searchInput placeholder="Search values" (keydown)="searchValues($event)" [(ngModel)]="searchValue" (ngModelChange)="searchValueChanged($event)">
          </div>
        </mat-option>
        <ng-container *ngFor="let value of values|async">
          <mat-option class="ngx-mat-query-search-autocomplete-option"  [value]="selectedValues" *ngIf="visibleValues.includes(value)">
            <div (click)="optionClicked($event, value)">
              <mat-checkbox [checked]="valueSelected(value)" (change)="toggleSelection(value)"
                            (click)="$event.stopPropagation()" disableRipple>
              <span class="value-option">
                <span class="option-label">{{value['displayValue'] || value}}</span>
                <span class="option-description" *ngIf="value['description'] as description">{{description}}</span>
              </span>
              </mat-checkbox>
            </div>
          </mat-option>
        </ng-container>
      </mat-autocomplete>
    </mat-form-field>
  </ng-container>
  <ng-template #dateField>
    <mat-form-field [appearance]="formFieldAppearance" class="value-field">
      <mat-label>Value</mat-label>
      <input matInput autocomplete="off" [matDatepicker]="valuePicker" [(ngModel)]="item.value"
             (ngModelChange)="dateUpdated($event)">
      <mat-datepicker-toggle matSuffix [for]="valuePicker"></mat-datepicker-toggle>
      <mat-datepicker #valuePicker></mat-datepicker>
    </mat-form-field>
  </ng-template>
</ng-container>
