<mat-divider class="notate-group" [vertical]="true"></mat-divider>
<mat-divider class="notate-group-after"></mat-divider>

<button mat-mini-fab color="warn" class="delete-button" (click)="remove()" [disabled]="disableDelete">
  <mat-icon>delete</mat-icon>
</button>

<mat-divider class="separate-button"></mat-divider>

<mat-checkbox class="disable-checkbox" [(ngModel)]="item.active"></mat-checkbox>
<mat-divider class="separate-button" [class.pad-dividers]="padDividers"></mat-divider>

<name-field [(selectedField)]="selectedField" (selectedFieldChange)="fieldSelected($event)"></name-field>

<operator-field *ngIf="showOperatorField" [item]="item" (operatorSelected)="operatorSelected($event)"></operator-field>

<ng-container *ngIf="showValueField">
  <mat-divider class="separate-fields" [class.pad-dividers]="padDividers"></mat-divider>
  <ng-container *ngIf="!isDate; else dateField">
    <plain-value-field [item]="item" [isNumber]="isNumber" *ngIf="!hasValues"></plain-value-field>

    <mat-form-field [appearance]="formFieldAppearance" *ngIf="hasValues" class="value-field">
      <mat-label>Value</mat-label>
      <input matInput
             #valueInput
             [(ngModel)]="item.value"
             [matAutocomplete]="valueAutoComplete">
      <div class="input-spinner-wrapper">
        <mat-spinner *ngIf="isObservable && ($loading|async)" [diameter]="20" class="input-spinner"></mat-spinner>
      </div>
      <mat-autocomplete autoActiveFirstOption #valueAutoComplete="matAutocomplete">
        <mat-option *ngIf="!($loading|async) && (totalValues|async)">
          <div (click)="searchOptionClicked($event)" class="search-options-wrapper">
            <mat-icon (click)="clearSearch()" matTooltip="Clear Search">search</mat-icon>
            <input class="search-options" #searchInput placeholder="Search values" (keydown)="searchValues($event)"
                   [(ngModel)]="searchValue" (ngModelChange)="searchValueChanged($event)">
          </div>
        </mat-option>
        <ng-container *ngFor="let value of values|async">
          <mat-option class="ngx-mat-query-search-autocomplete-option" [value]="selectedValues"
                      *ngIf="visibleValues.includes(value)">
            <div (click)="optionClicked($event, value)">
              <mat-checkbox [checked]="valueSelected(value)" (change)="toggleSelection(value)"
                            (click)="$event.stopPropagation()" disableRipple>
              <span class="value-option">
                <span class="option-label">{{value['displayValue'] || value}}</span>
                <span class="option-description" *ngIf="value['description'] as description">{{description}}</span>
              </span>
              </mat-checkbox>
            </div>
          </mat-option>
        </ng-container>
      </mat-autocomplete>
    </mat-form-field>
  </ng-container>
  <ng-template #dateField>
    <div class="between-dates" *ngIf="isBetweenDate; else singleDateField">
      <mat-divider vertical class="between-dates-outer"></mat-divider>
      <div class="between-dates-fields" [class.show]="showBetweenDateFields">
        <div class="between-date-field">
          <mat-divider></mat-divider>
          <mat-form-field [appearance]="formFieldAppearance" class="value-field">
            <mat-label>Start Date</mat-label>
            <input matInput autocomplete="off" [matDatepicker]="valuePicker" [(ngModel)]="leftDate"
                   (ngModelChange)="betweenDateUpdated()">
            <mat-datepicker-toggle matSuffix [for]="valuePicker"></mat-datepicker-toggle>
            <mat-datepicker #valuePicker></mat-datepicker>
          </mat-form-field>
        </div>
        <div class="between-date-field">
          <mat-divider></mat-divider>
          <mat-form-field [appearance]="formFieldAppearance" class="value-field" *ngIf="isBetweenDate">
            <mat-label>End Date</mat-label>
            <input matInput autocomplete="off" [matDatepicker]="secondValuePicker" [(ngModel)]="rightDate"
                   (ngModelChange)="betweenDateUpdated()">
            <mat-datepicker-toggle matSuffix [for]="secondValuePicker"></mat-datepicker-toggle>
            <mat-datepicker #secondValuePicker></mat-datepicker>
          </mat-form-field>
        </div>
      </div>
    </div>
    <ng-template #singleDateField>
      <mat-form-field [appearance]="formFieldAppearance" class="value-field">
        <mat-label>Value</mat-label>
        <input matInput autocomplete="off" [matDatepicker]="valuePicker" [(ngModel)]="item.value"
               (ngModelChange)="dateUpdated($event)">
        <mat-datepicker-toggle matSuffix [for]="valuePicker"></mat-datepicker-toggle>
        <mat-datepicker #valuePicker></mat-datepicker>
      </mat-form-field>
    </ng-template>
  </ng-template>
</ng-container>
